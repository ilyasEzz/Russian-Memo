<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: speed_typing.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: speed_typing.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>window.addEventListener('load', init);

// DOM Elements
const wordInput = document.querySelector('#word-input');
const currentWord = document.querySelector('#current-word');
const timeDisplay = document.querySelector('#time');
const message = document.querySelector('#message');
const seconds = document.querySelector('#seconds');
const speakerBtn = document.querySelector('#speaker');
const scoreDisplay = document.querySelector('#score');
const popup = document.querySelector('.popup-container');

/**
 * different Levels of the game
 * @type {object}
 * @property {number} easy - Easy difficulty
 * @property {number} medium - Midium difficulty
 * @property {number} hard - Maximum difficulty
 */
const levels = {
  easy: 10,
  medium: 5,
  hard: 3,
};

/**
 * Current Level
 * @default easy
 */
const currentLevel = levels.easy;

// Speech Synthesis API
const synth = window.speechSynthesis;

// Variables
let time = currentLevel;
let score = 0;
let gameOver;
let randIndex = 0;
let voices = [];
let inputFocus = false;

/**
 * Click on the speak icon
 * @event speak
 */
speakerBtn.addEventListener('click', speak);

// Functions
function init() {

  /**
   * Fetch cards from the API
   * @param none
   * @returns {Array&lt;Object>}
   */
  const fetchCards = async () => {
    let response = await fetch('http://127.0.0.1:8000/api/cards');
    let data = await response.json();
    console.log(data);
    return data;
  };

  seconds.innerHTML = currentLevel;
  // Load word from array
  fetchCards().then((words) => {
    showWord(words);

    // Start matching on word input
    wordInput.addEventListener('input', () => {
      inputFocus = true;

      if (matchWords(words)) {
        gameOver = false;
        time = currentLevel + 1;
        showWord(words);
        wordInput.value = '';
        score++;
        scoreDisplay.textContent = score;
      }
    });
    // Call countdown every second
    setInterval(countdown, 1000);
  });
}

/**
 * Match currentWord to wordInput
 * @function matchWords
 * @param {string} words - fetched words from the API
 * @returns {boolean} - true if coorect and false if not
 */
function matchWords(words) {
  if (words[randIndex].fields.translation === wordInput.value) {
    message.innerHTML = 'Correct!!!';
    return true;
  } else {
    message.innerHTML = '';
    return false;
  }
}

/**
 * Pick &amp; show random word
 * @function showWord
 * @param {string} words - fetched words from the API
 * @returns void
 */
function showWord(words) {
  // Generate random array index
  randIndex = Math.floor(Math.random() * words.length);
  // Output random word
  currentWord.innerHTML = words[randIndex].fields.word;
}


/**
 * Countdown timer
 * @function showWord
 * @returns void
 */
function countdown() {
  if (time > 0 &amp;&amp; inputFocus) {
    time--;
  } else if (time === 0) {
    gameOver = true;
    popup.style.display = 'flex';
    wordInput.disabled = true;
  }
  // Show time
  timeDisplay.innerHTML = time;
}

/**
 * Fill the voice array
 * @returns all the voices from the Speech Synthesis API
 */
getVoices = () => {
  voices = synth.getVoices();
};

// 
getVoices();
if (synth.onvoiceschanged !== undefined) {
  synth.onvoiceschanged = getVoices;
}

/**
 * Sending a Speech Request to the API
 * @returns void 
 */
function speak() {
  // Check if Already speaking
  if (synth.speaking) {
    console.error('Already speaking...');
    return;
  }

  // Sending a Speech Request to the API
  const speakRequest = new SpeechSynthesisUtterance(currentWord.innerHTML);

  // Run when the speacking will be done:
  speakRequest.onend = (e) => {};

  // Error
  speakRequest.onerror = (e) => {
    console.log('Speacking Error!');
  };

  // Choose the Accent
  speakRequest.voice = voices[0];

  speakRequest.rate = 1;
  speakRequest.pitch = 1.5;

  // Speak
  synth.speak(speakRequest);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Events</h3><ul><li><a href="global.html#event:speak">speak</a></li></ul><h3>Global</h3><ul><li><a href="global.html#currentLevel">currentLevel</a></li><li><a href="global.html#getVoices">getVoices</a></li><li><a href="global.html#levels">levels</a></li><li><a href="global.html#matchWords">matchWords</a></li><li><a href="global.html#showWord">showWord</a></li><li><a href="global.html#speak">speak</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sat Jun 13 2020 03:14:30 GMT+0700 (GMT+07:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
